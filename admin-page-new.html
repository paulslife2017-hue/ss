<!-- This will be embedded in shop-server-complete.js -->
<!-- Professional Admin Dashboard with Product Management -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - SeoulZen</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; background: #f5f6fa; }
        
        /* Sidebar Navigation */
        .admin-layout { display: flex; min-height: 100vh; }
        .sidebar { width: 260px; background: #2c3e50; color: white; position: fixed; height: 100vh; overflow-y: auto; }
        .sidebar-header { padding: 2rem 1.5rem; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .sidebar-header h1 { font-size: 1.5rem; margin-bottom: 0.3rem; }
        .sidebar-header p { font-size: 0.85rem; opacity: 0.7; }
        .sidebar-menu { padding: 1rem 0; }
        .menu-item { padding: 0.9rem 1.5rem; cursor: pointer; display: flex; align-items: center; gap: 0.8rem; transition: all 0.2s; border-left: 3px solid transparent; }
        .menu-item:hover { background: rgba(255,255,255,0.1); }
        .menu-item.active { background: rgba(255,107,157,0.2); border-left-color: #FF6B9D; }
        .menu-icon { font-size: 1.3rem; }
        
        /* Main Content */
        .main-content { margin-left: 260px; flex: 1; padding: 2rem; }
        .page-header { background: white; padding: 1.5rem 2rem; border-radius: 12px; margin-bottom: 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; }
        .page-header h2 { font-size: 1.8rem; color: #2c3e50; }
        
        /* Stats Cards */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .stat-card { background: white; padding: 1.8rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border-left: 4px solid #FF6B9D; }
        .stat-card h3 { color: #7f8c8d; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 0.8rem; }
        .stat-card .stat-value { font-size: 2.2rem; font-weight: bold; color: #2c3e50; }
        .stat-card .stat-change { font-size: 0.85rem; color: #27ae60; margin-top: 0.5rem; }
        
        /* Products Table */
        .content-section { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
        .section-header h3 { font-size: 1.3rem; color: #2c3e50; }
        
        /* Buttons */
        .btn { padding: 0.7rem 1.5rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s; font-size: 0.95rem; }
        .btn-primary { background: #FF6B9D; color: white; }
        .btn-primary:hover { background: #FF4081; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(255,107,157,0.3); }
        .btn-success { background: #27ae60; color: white; }
        .btn-success:hover { background: #229954; }
        .btn-danger { background: #e74c3c; color: white; }
        .btn-danger:hover { background: #c0392b; }
        .btn-small { padding: 0.4rem 0.8rem; font-size: 0.85rem; }
        
        /* Table */
        table { width: 100%; border-collapse: collapse; }
        thead { background: #f8f9fa; }
        th { padding: 1rem; text-align: left; font-weight: 600; color: #2c3e50; border-bottom: 2px solid #e0e0e0; }
        td { padding: 1rem; border-bottom: 1px solid #f0f0f0; vertical-align: middle; }
        tr:hover { background: #f8f9fa; }
        .product-img { width: 60px; height: 60px; object-fit: cover; border-radius: 8px; }
        .badge { padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.8rem; font-weight: 600; }
        .badge-success { background: #d4edda; color: #155724; }
        .badge-danger { background: #f8d7da; color: #721c24; }
        .badge-warning { background: #fff3cd; color: #856404; }
        
        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; }
        .modal.active { display: flex; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 2.5rem; border-radius: 12px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .modal-header h3 { font-size: 1.5rem; color: #2c3e50; }
        .modal-close { font-size: 2rem; cursor: pointer; color: #7f8c8d; }
        .modal-close:hover { color: #2c3e50; }
        
        /* Form */
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; color: #2c3e50; font-weight: 600; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 0.8rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 0.95rem; transition: border 0.3s; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #FF6B9D; }
        .form-group textarea { min-height: 100px; resize: vertical; }
        
        /* Login */
        .login-container { min-height: 100vh; display: flex; justify-content: center; align-items: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .login-box { background: white; padding: 3rem; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); max-width: 400px; width: 90%; }
        .login-box h2 { margin-bottom: 2rem; color: #2c3e50; text-align: center; }
        
        /* Hidden class */
        .hidden { display: none !important; }
        
        /* Search */
        .search-box { padding: 0.8rem 1rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 0.95rem; width: 300px; }
        .search-box:focus { outline: none; border-color: #FF6B9D; }
        
        /* Action buttons group */
        .action-buttons { display: flex; gap: 0.5rem; }
    </style>
</head>
<body>
    <div id="app-root">
        <!-- Login Screen (shown initially) -->
        <div id="login-screen" class="login-container">
            <div class="login-box">
                <h2>üîê Admin Login</h2>
                <form onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="login-password" placeholder="Enter password" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
                    <p style="text-align: center; margin-top: 1rem; color: #7f8c8d; font-size: 0.9rem;">
                        Hint: Special date üîê
                    </p>
                </form>
            </div>
        </div>

        <!-- Admin Dashboard (hidden initially) -->
        <div id="admin-dashboard" class="admin-layout hidden">
            <!-- Sidebar -->
            <div class="sidebar">
                <div class="sidebar-header">
                    <h1>üå∏ SeoulZen</h1>
                    <p>Admin Panel</p>
                </div>
                <div class="sidebar-menu">
                    <div class="menu-item active" onclick="showSection('dashboard')">
                        <span class="menu-icon">üìä</span>
                        <span>Dashboard</span>
                    </div>
                    <div class="menu-item" onclick="showSection('products')">
                        <span class="menu-icon">üì¶</span>
                        <span>Products</span>
                    </div>
                    <div class="menu-item" onclick="showSection('orders')">
                        <span class="menu-icon">üõí</span>
                        <span>Orders</span>
                    </div>
                    <div class="menu-item" onclick="logout()">
                        <span class="menu-icon">üö™</span>
                        <span>Logout</span>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <!-- Dashboard Section -->
                <div id="section-dashboard" class="section-content">
                    <div class="page-header">
                        <h2>üìä Dashboard</h2>
                    </div>
                    
                    <div class="stats-grid" id="stats-container">
                        <!-- Stats will be loaded here -->
                    </div>
                    
                    <div class="content-section">
                        <h3>üì¶ Recent Orders</h3>
                        <div id="recent-orders-table">
                            <!-- Recent orders will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Products Section -->
                <div id="section-products" class="section-content hidden">
                    <div class="page-header">
                        <h2>üì¶ Product Management</h2>
                        <button class="btn btn-primary" onclick="openProductModal()">
                            ‚ûï Add New Product
                        </button>
                    </div>
                    
                    <div class="content-section">
                        <div class="section-header">
                            <input type="text" class="search-box" placeholder="Search products..." id="product-search" onkeyup="filterProducts()">
                            <span id="product-count">0 products</span>
                        </div>
                        <div id="products-table-container">
                            <!-- Products table will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Orders Section -->
                <div id="section-orders" class="section-content hidden">
                    <div class="page-header">
                        <h2>üõí Order Management</h2>
                    </div>
                    
                    <div class="content-section">
                        <div id="orders-table-container">
                            <!-- Orders table will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Modal -->
    <div id="product-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Add New Product</h3>
                <span class="modal-close" onclick="closeProductModal()">&times;</span>
            </div>
            <form id="product-form" onsubmit="saveProduct(event)">
                <input type="hidden" id="product-id">
                
                <div class="form-group">
                    <label>Product Name *</label>
                    <input type="text" id="product-name" required>
                </div>
                
                <div class="form-group">
                    <label>Brand *</label>
                    <input type="text" id="product-brand" required>
                </div>
                
                <div class="form-group">
                    <label>Category *</label>
                    <select id="product-category" required>
                        <option value="">Select Category</option>
                        <option value="cleanser">Cleanser</option>
                        <option value="toner">Toner</option>
                        <option value="serum">Serum</option>
                        <option value="moisturizer">Moisturizer</option>
                        <option value="sunscreen">Sunscreen</option>
                        <option value="mask">Mask</option>
                        <option value="set">Set</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Price ($) *</label>
                    <input type="number" id="product-price" step="0.01" min="0" required>
                </div>
                
                <div class="form-group">
                    <label>Original Price ($)</label>
                    <input type="number" id="product-original-price" step="0.01" min="0">
                </div>
                
                <div class="form-group">
                    <label>Image URL *</label>
                    <input type="url" id="product-image" required placeholder="https://example.com/image.jpg">
                    <small style="color: #7f8c8d;">Paste image URL from Unsplash, Imgur, etc.</small>
                </div>
                
                <div class="form-group">
                    <label>Description *</label>
                    <textarea id="product-description" required></textarea>
                </div>
                
                <div class="form-group">
                    <label>Stock Quantity *</label>
                    <input type="number" id="product-stock" min="0" value="100" required>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="product-featured"> Featured Product
                    </label>
                </div>
                
                <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem;">
                    <button type="button" class="btn" onclick="closeProductModal()" style="background: #95a5a6; color: white;">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Product</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let adminPassword = '';
        let allProducts = [];
        let allOrders = [];

        // Login
        async function handleLogin(event) {
            event.preventDefault();
            adminPassword = document.getElementById('login-password').value;
            
            try {
                const response = await fetch(\`/api/admin/stats?password=\${adminPassword}\`);
                if (response.ok) {
                    document.getElementById('login-screen').classList.add('hidden');
                    document.getElementById('admin-dashboard').classList.remove('hidden');
                    await loadDashboard();
                } else {
                    alert('‚ùå Invalid password!');
                }
            } catch (error) {
                alert('‚ùå Login failed!');
            }
        }

        // Logout
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                adminPassword = '';
                document.getElementById('login-screen').classList.remove('hidden');
                document.getElementById('admin-dashboard').classList.add('hidden');
                document.getElementById('login-password').value = '';
            }
        }

        // Navigation
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section-content').forEach(el => el.classList.add('hidden'));
            // Show selected section
            document.getElementById(\`section-\${sectionName}\`).classList.remove('hidden');
            
            // Update active menu
            document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
            event.target.closest('.menu-item').classList.add('active');
            
            // Load section data
            if (sectionName === 'dashboard') loadDashboard();
            else if (sectionName === 'products') loadProducts();
            else if (sectionName === 'orders') loadOrders();
        }

        // Load Dashboard
        async function loadDashboard() {
            try {
                const response = await fetch(\`/api/admin/stats?password=\${adminPassword}\`);
                const stats = await response.json();
                
                document.getElementById('stats-container').innerHTML = \`
                    <div class="stat-card">
                        <h3>Total Products</h3>
                        <div class="stat-value">\${stats.totalProducts || 0}</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total Orders</h3>
                        <div class="stat-value">\${stats.totalOrders}</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total Revenue</h3>
                        <div class="stat-value">$\${stats.totalRevenue.toFixed(2)}</div>
                    </div>
                    <div class="stat-card">
                        <h3>Pending Orders</h3>
                        <div class="stat-value">\${stats.pendingOrders}</div>
                    </div>
                \`;
                
                // Load recent orders
                const ordersResponse = await fetch(\`/api/admin/orders?password=\${adminPassword}\`);
                allOrders = await ordersResponse.json();
                
                const recentOrders = allOrders.slice(0, 5);
                document.getElementById('recent-orders-table').innerHTML = recentOrders.length > 0 ? \`
                    <table>
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Total</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            \${recentOrders.map(order => \`
                                <tr>
                                    <td><strong>\${order.id}</strong></td>
                                    <td>\${order.customer.fullName}</td>
                                    <td><strong>$\${order.total.toFixed(2)}</strong></td>
                                    <td><span class="badge badge-warning">\${order.status.toUpperCase()}</span></td>
                                </tr>
                            \`).join('')}
                        </tbody>
                    </table>
                \` : '<p>No orders yet.</p>';
            } catch (error) {
                console.error('Failed to load dashboard:', error);
            }
        }

        // Load Products
        async function loadProducts() {
            try {
                const response = await fetch(\`/api/admin/products?password=\${adminPassword}\`);
                allProducts = await response.json();
                renderProducts(allProducts);
            } catch (error) {
                console.error('Failed to load products:', error);
            }
        }

        function renderProducts(products) {
            document.getElementById('product-count').textContent = \`\${products.length} products\`;
            
            document.getElementById('products-table-container').innerHTML = products.length > 0 ? \`
                <table>
                    <thead>
                        <tr>
                            <th>Image</th>
                            <th>Name</th>
                            <th>Brand</th>
                            <th>Category</th>
                            <th>Price</th>
                            <th>Stock</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        \${products.map(product => \`
                            <tr>
                                <td><img src="\${product.image}" class="product-img" alt="\${product.name}"></td>
                                <td><strong>\${product.name}</strong></td>
                                <td>\${product.brand}</td>
                                <td>\${product.category}</td>
                                <td>$\${product.price}</td>
                                <td>\${product.stock}</td>
                                <td>
                                    <span class="badge \${product.inStock ? 'badge-success' : 'badge-danger'}">
                                        \${product.inStock ? 'In Stock' : 'Out of Stock'}
                                    </span>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-small btn-success" onclick="editProduct(\${product.id})">Edit</button>
                                        <button class="btn btn-small btn-danger" onclick="deleteProduct(\${product.id})">Delete</button>
                                    </div>
                                </td>
                            </tr>
                        \`).join('')}
                    </tbody>
                </table>
            \` : '<p>No products found.</p>';
        }

        // Filter Products
        function filterProducts() {
            const search = document.getElementById('product-search').value.toLowerCase();
            const filtered = allProducts.filter(p => 
                p.name.toLowerCase().includes(search) ||
                p.brand.toLowerCase().includes(search) ||
                p.category.toLowerCase().includes(search)
            );
            renderProducts(filtered);
        }

        // Product Modal
        function openProductModal(productId = null) {
            if (productId) {
                // Edit mode
                const product = allProducts.find(p => p.id === productId);
                document.getElementById('modal-title').textContent = 'Edit Product';
                document.getElementById('product-id').value = product.id;
                document.getElementById('product-name').value = product.name;
                document.getElementById('product-brand').value = product.brand;
                document.getElementById('product-category').value = product.category;
                document.getElementById('product-price').value = product.price;
                document.getElementById('product-original-price').value = product.originalPrice || '';
                document.getElementById('product-image').value = product.image;
                document.getElementById('product-description').value = product.description;
                document.getElementById('product-stock').value = product.stock;
                document.getElementById('product-featured').checked = product.featured;
            } else {
                // Add mode
                document.getElementById('modal-title').textContent = 'Add New Product';
                document.getElementById('product-form').reset();
                document.getElementById('product-id').value = '';
            }
            document.getElementById('product-modal').classList.add('active');
        }

        function closeProductModal() {
            document.getElementById('product-modal').classList.remove('active');
            document.getElementById('product-form').reset();
        }

        function editProduct(productId) {
            openProductModal(productId);
        }

        // Save Product
        async function saveProduct(event) {
            event.preventDefault();
            
            const productId = document.getElementById('product-id').value;
            const productData = {
                name: document.getElementById('product-name').value,
                brand: document.getElementById('product-brand').value,
                category: document.getElementById('product-category').value,
                price: parseFloat(document.getElementById('product-price').value),
                originalPrice: document.getElementById('product-original-price').value || null,
                image: document.getElementById('product-image').value,
                description: document.getElementById('product-description').value,
                stock: parseInt(document.getElementById('product-stock').value),
                inStock: parseInt(document.getElementById('product-stock').value) > 0,
                featured: document.getElementById('product-featured').checked,
                keyBenefits: ['High quality K-Beauty product'],
                howToUse: 'Apply as directed',
                ingredients: 'See product packaging',
                rating: 4.5,
                reviews: 0,
                tags: ['new']
            };
            
            try {
                let response;
                if (productId) {
                    // Update existing product
                    response = await fetch(\`/api/admin/products/\${productId}?password=\${adminPassword}\`, {
                        method: 'PATCH',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(productData)
                    });
                } else {
                    // Create new product
                    response = await fetch(\`/api/admin/products?password=\${adminPassword}\`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(productData)
                    });
                }
                
                if (response.ok) {
                    alert('‚úÖ Product saved successfully!');
                    closeProductModal();
                    await loadProducts();
                } else {
                    alert('‚ùå Failed to save product');
                }
            } catch (error) {
                alert('‚ùå Error saving product');
                console.error(error);
            }
        }

        // Delete Product
        async function deleteProduct(productId) {
            if (!confirm('Are you sure you want to delete this product?')) return;
            
            try {
                const response = await fetch(\`/api/admin/products/\${productId}?password=\${adminPassword}\`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    alert('‚úÖ Product deleted successfully!');
                    await loadProducts();
                } else {
                    alert('‚ùå Failed to delete product');
                }
            } catch (error) {
                alert('‚ùå Error deleting product');
            }
        }

        // Load Orders
        async function loadOrders() {
            try {
                const response = await fetch(\`/api/admin/orders?password=\${adminPassword}\`);
                allOrders = await response.json();
                
                document.getElementById('orders-table-container').innerHTML = allOrders.length > 0 ? \`
                    <table>
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Date</th>
                                <th>Items</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            \${allOrders.map(order => \`
                                <tr>
                                    <td><strong>\${order.id}</strong></td>
                                    <td>
                                        \${order.customer.fullName}<br>
                                        <small style="color: #7f8c8d;">\${order.customer.email}</small>
                                    </td>
                                    <td>\${new Date(order.date).toLocaleString()}</td>
                                    <td>\${order.items.length} items</td>
                                    <td><strong>$\${order.total.toFixed(2)}</strong></td>
                                    <td>
                                        <span class="badge badge-warning">\${order.status.toUpperCase()}</span>
                                    </td>
                                    <td>
                                        <select onchange="updateOrderStatus('\${order.id}', this.value)" style="padding: 0.5rem; border-radius: 5px;">
                                            <option value="">Change Status</option>
                                            <option value="pending">Pending</option>
                                            <option value="processing">Processing</option>
                                            <option value="shipped">Shipped</option>
                                            <option value="completed">Completed</option>
                                            <option value="cancelled">Cancelled</option>
                                        </select>
                                    </td>
                                </tr>
                            \`).join('')}
                        </tbody>
                    </table>
                \` : '<p>No orders yet.</p>';
            } catch (error) {
                console.error('Failed to load orders:', error);
            }
        }

        // Update Order Status
        async function updateOrderStatus(orderId, newStatus) {
            if (!newStatus) return;
            
            try {
                const response = await fetch(\`/api/admin/orders/\${orderId}?password=\${adminPassword}\`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ status: newStatus })
                });
                
                if (response.ok) {
                    alert('‚úÖ Order status updated!');
                    await loadOrders();
                } else {
                    alert('‚ùå Failed to update order status');
                }
            } catch (error) {
                alert('‚ùå Error updating order');
            }
        }
    </script>
</body>
</html>
